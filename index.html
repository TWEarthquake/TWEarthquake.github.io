<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>臺灣地震速報 - 線上</title>
    <link rel="icon" href="./f256x256.png" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="./eew.css">
	<link rel="manifest" href="./manifest.json"/>
    <style>
        @keyframes WebLoad {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        body {
            margin: 0;
            animation: WebLoad 2s;
        }
    </style>
    <script src='./eew.js'></script>
    <script src='./locations.js'></script>
	<script src='./mapLib.js'></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <div class="notice" onclick="unshow_notice()">
        <div>
            <p>使用前請詳閱 <a href="/about" target="_blank">關於地震速報</a>，如繼續使用，即視為了解且同意該頁面內容。</p>
            <p>注意：離開此頁面可能導致無法接收速報</p>
			<p style="margin-top: 50px; animation: black-red 1s ease-in-out infinite alternate;">點擊任意處以繼續</p>
        </div>
    </div>
    <div id="notification-container"></div>
    <div id="container">
        <div id="map">
            <p class="menu" onclick="openMenu()">☰</p>
            <div id="sideMenu">
                <span class="closeBtn" onclick="closeMenu()">&times;</span>
                <a href="/report" target="_blank">地震報告</a>
                <a href="/statistics" target="_blank">統計資料</a>
                <a href="/changelog" target="_blank">更新日誌</a>
                <a href="/minecraft" target="_blank">Minecraft ✗ 地震速報</a>
            </div>
        </div>
        <div id="warning-information">
            <div class="top">
                <div class="epicenter-table">
                    <div class="row" style="padding: 0;">
                        <div style="font-size: 14px; color: red; text-align: center;">注意：離開此頁面可能導致無法接收速報</div>
                    </div>
                </div>
				<div class="epicenter-table">
                    <div class="row" style="padding: 0;">
                        <div class="header" style="font-size: 28px;font-weight: bold;color: #333333;">所在地</div>
						<div class="content">
                            <span id="connectStats" style="color: orange; font-size: 12px;">● 連線中</span>
                        </div>
                    </div>
                </div>
                <div class="epicenter-table">
                    <div class="row">
                        <div class="header">距震央</div>
                        <div class="content" id="distanceLabel">- 公里</div>
                    </div>
                </div>
                <div id="warning-location">
                    <div class="container">
                        <div class="background">級</div>
                        <div class="wrapper">
                            <div class="header">震度</div>
                            <div class="content">
                                <div class="value" id="levelLabel" style="color: black">N/A</div>
                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="background">秒</div>
                        <div class="wrapper">
                            <div class="header">抵達</div>
                            <div class="content">
                                <div class="value" id="secondLabel">0</div>
                            </div>
                        </div>
                    </div>
                </div>
				<div class="epicenter-table">
                    <div class="row" style="padding: 0;">
                        <div class="header" style="font-size: 28px;font-weight: bold;color: #333333;">震央</div>
                        <div class="content" style="display: flex; column-gap: 10px;">
                            <button id="muteButton" class="warning-button" style="display: none" onclick="mute()">靜音</button>
                            <button id="replayButton" class="warning-button" style="display:block" onclick="replay()">重現</button>
                        </div>
                    </div>
                </div>
                <div class="epicenter-table">
                    <div class="row">
                        <div class="header">時間</div>
                        <div class="content" id="timeLabel">N/A</div>
                    </div>
                    <div class="row">
                        <div class="header">位置</div>
                        <div class="content" id="loactionLabel">N/A°N, N/A°E<br>(位於N/A)</div>
                    </div>
                    <div class="row">
                        <div class="header">深度</div>
                        <div class="content" id="depthLabel">N/A 公里</div>
                    </div>
                    <div class="row">
                        <div class="header">規模</div>
                        <div class="content" id="scaleLabel">N/A</div>
                    </div>
                    <div class="row">
                        <div class="header">最大震度</div>
                        <div class="content" id="maxLevelLabel">N/A</div>
                    </div>
                </div>
                <div class="epicenter-table">
                    <div class="row" style="align-items: flex-end; padding: 0;">
                        <div class="header" style="font-size: 28px;font-weight: bold">設定</div>
                    </div>
                </div>
                <div class="epicenter-table">
                    <div class="row">
                        <div class="header">所在地</div>
                        <div class="content">
                            <select id="citySelect">
                                <option value="Taipei" selected>台北市</option>
                                <option value="NewTaipei">新北市</option>
                                <option value="Taoyuan">桃園市</option>
                                <option value="Hsinchu">新竹市(縣)</option>
                                <option value="Miaoli">苗栗縣</option>
                                <option value="Taichung">台中市</option>
                                <option value="Nantou">南投縣</option>
                                <option value="Changhua">彰化縣</option>
                                <option value="Yunlin">雲林縣</option>
                                <option value="Chiayi">嘉義市(縣)</option>
                                <option value="Tainan">台南市</option>
                                <option value="Kaohsiung">高雄市</option>
                                <option value="Pingtung">屏東縣</option>
                                <option value="Keelung">基隆市</option>
                                <option value="Yilan">宜蘭縣</option>
                                <option value="Hualien">花蓮縣</option>
                                <option value="Taitung">台東縣</option>
                                <option value="Lianjiang">連江縣</option>
                                <option value="Kinmen">金門縣</option>
                                <option value="Penghu">澎湖縣</option>
                            </select>
                            <select id="townSelect">
                                    <option value="" selected>信義區</option>
                                    <option value="1">松山區</option>
                                    <option value="2">大安區</option>
                                    <option value="3">中山區</option>
                                    <option value="4">中正區</option>
                                    <option value="5">大同區</option>
                                    <option value="6">萬華區</option>
                                    <option value="7">文山區</option>
                                    <option value="8">南港區</option>
                                    <option value="9">內湖區</option>
                                    <option value="10">士林區</option>
                                    <option value="11">北投區</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="header">預警震度</div>
                        <div class="content">
                            <select id="alertLevelSelect">
                                <option value="0" selected>0 級</option>
                                <option value="1">1 級</option>
                                <option value="2">2 級</option>
                                <option value="3">3 級</option>
                                <option value="4">4 級</option>
                                <option value="5">5 弱</option>
                                <option value="6">5 強</option>
                                <option value="7">6 弱</option>
                                <option value="8">6 強</option>
                                <option value="9">7 級</option>
                            </select>
                        </div>
                    </div>
                    <!-- <div class="row">
                        <div class="header">P-Alert</div>
                        <div class="content">
                            <select id="pAlertSelect">
                                <option value="True" selected>是</option>
                                <option value="False">否</option>
                            </select>
                        </div>
                    </div> -->
                    <div class="row">
                        <div class="header">外觀</div>
                        <div class="content">
                            <select id="styleSelect" onchange="">
                                <option value="Light" selected>淺色</option>
                                <option value="Dark">深色</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="header">音量</div>
                        <div class="content">
                            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
                        </div>
                    </div>
                </div>
				<div class="epicenter-table">
                    <div class="row" style="align-items: flex-end; padding: 0;">
                        <div class="header" style="font-size: 28px;font-weight: bold">通知</div>
                    </div>
                </div>
                <div class="epicenter-table">
                    <div class="row">
                        <div class="header">地震速報</div>
                        <div class="content">
                            <button class="unsub-button" id="sub-eew-button">取消訂閱</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="header">小區域有感地震</div>
                        <div class="content">
                            <button class="sub-button" id="sub-sreport-button">訂閱</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="header">顯著有感地震</div>
                        <div class="content">
                            <button class="sub-button" id="sub-report-button">訂閱</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="header">海嘯警報</div>
                        <div class="content">
                            <button class="sub-button" id="sub-tsu-button">訂閱</button>
                        </div>
                    </div>
                </div>
                <span class="foot">本服務使用音效係由「地牛Wake Up!」授權使用</span>
                <br>
                <span class="foot">Copyrights &copy; 2024-2026, Chang Yu-Hsi. All rights reserved.</span>
                <div class="epicenter-table">
                    <div class="row">
                        <a href="https://linktr.ee/tw.earthquake" target="_blank">社群連結</a>
                        <a href="/about" target="_blank">關於地震速報</a>
                        <a href="/donate" target="_blank">贊助我們</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="legend">
        <div id="warning-legend">
            <div class="legend-column" style="width:48px;">
                <div style="margin-bottom:1px">震度</div>
                <div class="legend-intensity">
                    <div class="row"><div class="cell"><span class="color i7"></span></div><div class="cell" style="padding-left:3px">7</div></div>
                    <div class="row"><div class="cell"><span class="color i6s"></span></div><div class="cell" style="padding-left:3px">6+</div></div>
                    <div class="row"><div class="cell"><span class="color i6w"></span></div><div class="cell" style="padding-left:3px">6-</div></div>
                    <div class="row"><div class="cell"><span class="color i5s"></span></div><div class="cell" style="padding-left:3px">5+</div></div>
                    <div class="row"><div class="cell"><span class="color i5w"></span></div><div class="cell" style="padding-left:3px">5-</div></div>
                    <div class="row"><div class="cell"><span class="color i4"></span></div><div class="cell" style="padding-left:3px">4</div></div>
                    <div class="row"><div class="cell"><span class="color i3"></span></div><div class="cell" style="padding-left:3px">3</div></div>
                    <div class="row"><div class="cell"><span class="color i2"></span></div><div class="cell" style="padding-left:3px">2</div></div>
                    <div class="row"><div class="cell"><span class="color i1"></span></div><div class="cell" style="padding-left:3px">1</div></div>
                    <div class="row"><div class="cell"><span class="color i0"></span></div><div class="cell" style="padding-left:3px">0</div></div>
                </div>
            </div>
            <div class="legend-column" style="width:55px;">
                <div style="margin-bottom:1px">震央<br>(速報)</div>
                <div class="legend-intensity">
                    <img src="./cross.png" height="24" width="24">
                </div>
                <div style="margin-bottom:1px">震央<br>(報告)</div>
                <div class="legend-intensity">
                    <img src="./cross_blue.png" height="24" width="24">
                </div>
                <!-- <div style="margin-bottom:1px">P-Alert</div>
                <div class="legend-intensity">
                    <img src="./Web/pcross.png" height="24" width="24">
                </div> -->
                <div style="margin-bottom:1px">所在地</div>
                <div class="legend-intensity">
                    <img src="https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png" width="24">
                </div>
            </div>
            <div class="legend-column" style="width:80px;">
                <div style="margin-bottom:1px">預估波高</div>
                <div class="legend-intensity">
                    <div class="row"><div class="cell"><span class="color i7"></span></div><div class="cell" style="padding-left:3px">>6</div></div>
                    <div class="row"><div class="cell"><span class="color i6w"></span></div><div class="cell" style="padding-left:3px">3~6</div></div>
                    <div class="row"><div class="cell"><span class="color i5s"></span></div><div class="cell" style="padding-left:3px">1~3</div></div>
                    <div class="row"><div class="cell"><span class="color i4"></span></div><div class="cell" style="padding-left:3px">0.3~1</div></div>
                    <div class="row"><div class="cell"><span class="color i3"></span></div><div class="cell" style="padding-left:3px"><0.3</div></div>
                    <div class="row"><div class="cell"><span class="color ia"></span></div><div class="cell" style="padding-left:3px">注意</div></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const map = L.map('map', {
            center: [24, 120.9605],
            zoom: 7.5,
            dragging: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            zoomControl: false,
            keyboard: false,
            boxZoom: false,
            attributionControl: false
        });

        const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '',
            subdomains: 'abcd',
            maxZoom: 19
        });

        const lightLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '',
            subdomains: 'abcd',
            maxZoom: 19
        });

        lightLayer.addTo(map);
    </script>
</body>
<script>
    function openMenu() {
        document.getElementById("sideMenu").style.width = "250px";
		document.getElementById("sideMenu").style.border = "1.5px solid black";
    }
    function closeMenu() {
        document.getElementById("sideMenu").style.width = "0";
		document.getElementById("sideMenu").style.border = "none";
    }
</script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAAY4KSVU8YkXFvXOSqxIGep6U5zv-P38M",
        authDomain: "earthquakeweb-a0353.firebaseapp.com",
        projectId: "earthquakeweb-a0353",
        storageBucket: "earthquakeweb-a0353.firebasestorage.app",
        messagingSenderId: "288541522957",
        appId: "1:288541522957:web:8e41b718c686f3c2b02944",
        measurementId: "G-D8T63Q32KV"
    };

    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    const registration = await navigator.serviceWorker.register("/firebase-messaging-sw.js");
    await navigator.serviceWorker.ready;

    Notification.requestPermission().then(permission => {
        if (permission === "granted") {
            getToken(messaging, {
                vapidKey: "BADutuxr5DLm3jVgfkkAI0Uz7zx4eIXNUxmrE6ntTmOxto_Ab5hWznNh6olRqHOaKmKQsEf9v-nhu1-Feisdimk",
                serviceWorkerRegistration: registration
            }).then((currentToken) => {
				userToken = currentToken;
                setTimeout(() => {
                    fetch(subUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ token: currentToken, type: 'eew' })
                    })
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('sub-eew-button').innerText = data.state[0] == 'True' ? '取消訂閱' : '訂閱';
                        document.getElementById('sub-sreport-button').innerText = data.state[2] == 'True' ? '取消訂閱' : '訂閱';
                        document.getElementById('sub-report-button').innerText = data.state[1] == 'True' ? '取消訂閱' : '訂閱';
                        document.getElementById('sub-tsu-button').innerText = data.state[3] == 'True' ? '取消訂閱' : '訂閱';

                        document.getElementById('sub-eew-button').className = data.state[0] == 'True' ? 'unsub-button' : 'sub-button';
                        document.getElementById('sub-sreport-button').className = data.state[2] == 'True' ? 'unsub-button' : 'sub-button';
                        document.getElementById('sub-report-button').className = data.state[1] == 'True' ? 'unsub-button' : 'sub-button';
                        document.getElementById('sub-tsu-button').className = data.state[3] == 'True' ? 'unsub-button' : 'sub-button';
                    });
                }, 500);
            });
        }
    });
</script>
</html>
























